"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _react=_interopRequireWildcard(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));require("./style.css");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}var BACKSPACE_KEY=8;var LEFTARROW_KEY=37;var RIGHTARROW_KEY=39;var NOT_SELECTED=-1;var EMPTY_CHARACTER=" ";function OTP(_ref){var value=_ref.value,setValue=_ref.setValue,numberOfInputs=_ref.numberOfInputs,isNumber=_ref.isNumber,placeholder=_ref.placeholder,primaryText=_ref.primaryText,secondaryText=_ref.secondaryText,hasErrored=_ref.hasErrored,isDisabled=_ref.isDisabled,resendDuration=_ref.resendDuration,onOtpResend=_ref.onOtpResend,inputStyle=_ref.inputStyle,inputClass=_ref.inputClass,containerStyle=_ref.containerStyle,containerClass=_ref.containerClass,primaryTextStyle=_ref.primaryTextStyle,primaryTextClass=_ref.primaryTextClass,secondaryTextStyle=_ref.secondaryTextStyle,secondaryTextClass=_ref.secondaryTextClass,primaryButtonStyle=_ref.primaryButtonStyle,primaryButtonClass=_ref.primaryButtonClass,secondaryButtonStyle=_ref.secondaryButtonStyle,secondaryButtonClass=_ref.secondaryButtonClass,onOTPSubmit=_ref.onOTPSubmit;var ref=(0,_react.useRef)(null);var index=(0,_react.useRef)(NOT_SELECTED);var keyCode=(0,_react.useRef)(null);var _useState=(0,_react.useState)(false),_useState2=_slicedToArray(_useState,2),isResendInactive=_useState2[0],setIsResendInactive=_useState2[1];var _useState3=(0,_react.useState)(true),_useState4=_slicedToArray(_useState3,2),isDisabledSubmit=_useState4[0],setIsDisabledSubmit=_useState4[1];var _useState5=(0,_react.useState)(true),_useState6=_slicedToArray(_useState5,2),isDisabledClear=_useState6[0],setIsDisabledClear=_useState6[1];var duration=resendDuration-1;var _useState7=(0,_react.useState)(Math.floor(duration/60)),_useState8=_slicedToArray(_useState7,2),minutes=_useState8[0],setMinutes=_useState8[1];var seconds=duration%60;var _useState9=(0,_react.useState)(seconds),_useState10=_slicedToArray(_useState9,2),counter=_useState10[0],setCounter=_useState10[1];var validRegex=isNumber?/^[0-9]+$/:/./;(0,_react.useEffect)(function(){var handleClickOutside=function handleClickOutside(event){if(ref.current&&!ref.current.contains(event.target)){setPosition(NOT_SELECTED);}};document.addEventListener("click",handleClickOutside,true);return function(){document.removeEventListener("click",handleClickOutside,true);};},[]);(0,_react.useEffect)(function(){if(hasErrored===true){var inputClassAll=document.querySelectorAll(".otp__input");for(var i=0;i<inputClassAll.length;i++){inputClassAll[i].classList.toggle("otp__input--active");}}else{var _inputClassAll=document.querySelectorAll(".otp__input");for(var _i2=0;_i2<_inputClassAll.length;_i2++){_inputClassAll[_i2].classList.remove("otp__input--active");}}},[hasErrored]);(0,_react.useEffect)(function(){if(index.current!==NOT_SELECTED){if(value.length-1>=index.current){if(index.current<numberOfInputs-1){var nextInput=document.getElementById("index-".concat(index.current+1));nextInput.focus();return;}}if(value.length<numberOfInputs&&keyCode.current!==BACKSPACE_KEY){var _nextInput=document.getElementById("index-".concat(value.length));_nextInput.focus();}}},[value,numberOfInputs]);var noOfInputs=numberOfInputs;(0,_react.useEffect)(function(){if(value!==""){setIsDisabledClear(false);}else{setIsDisabledClear(true);}if(value.length===noOfInputs){setIsDisabledSubmit(false);}else{setIsDisabledSubmit(true);}},[value,noOfInputs]);(0,_react.useEffect)(function(){if(isResendInactive){var timer=counter>0&&setInterval(function(){return setCounter(counter-1);},1000);if(counter===0){if(minutes>0){setCounter(59);setMinutes(minutes-1);}else{setIsResendInactive(false);}}}return function(){clearInterval(timer);};},[counter,minutes,isResendInactive]);function handleOnClear(){setValue("");var nextInput=document.getElementById("index-0");nextInput.focus();}function handleOnResend(){setIsResendInactive(true);setMinutes(Math.floor(duration/60));setCounter(seconds);onOtpResend();}function onInputFocus(e,pos){var currentInput=document.getElementById("index-".concat(pos));if(currentInput!==null){currentInput.classList.remove("otp__input--active");}setTimeout(function(){currentInput.setSelectionRange(0,1);},0);setPosition(pos);}function setPosition(pos){index.current=pos;}function handleKeyDown(e){keyCode.current=e.keyCode;if(keyCode.current===BACKSPACE_KEY){if(index.current!==NOT_SELECTED){var newvalue=removeCharacter(value,index.current);setValue(newvalue);if(index.current>0){var nextInput=document.getElementById("index-".concat(index.current-1));nextInput.focus();}}}if(e.keyCode===LEFTARROW_KEY){if(index.current>0){var prevInput=document.getElementById("index-".concat(index.current-1));prevInput.focus();}}if(e.keyCode===RIGHTARROW_KEY){if(index.current<numberOfInputs-1){var _nextInput2=document.getElementById("index-".concat(index.current+1));_nextInput2.focus();}}}function handleOnChange(e){var _char=e.target.value[0];if(_char===EMPTY_CHARACTER){if(index.current<numberOfInputs-1){var nextInput=document.getElementById("index-".concat(index.current+1));nextInput.focus();}return;}if(e.target.value.match(validRegex)){if(index.current!==NOT_SELECTED){if(e.target.value!==""){if(value.length===0){setValue(_char);}else if(value.length-1<index.current){setValue(value+_char);}else if(value.length-1>=index.current){var newvalue=setCharAt(value,index.current,_char);setValue(newvalue);}}}}}function removeCharacter(str,index){var subStr1=str.substring(0,index);var subStr2=str.substring(index+1,str.length);return subStr1+subStr2;}function setCharAt(str,index,chr){if(index>str.length-1)return str;return str.substring(0,index)+chr+str.substring(index+1);}function onPaste(e){var clipboardData,pastedData;e.stopPropagation();e.preventDefault();clipboardData=e.clipboardData||window.clipboardData;pastedData=clipboardData.getData("Text");pastedData=pastedData.trim();if(pastedData.match(validRegex)){var str=pastedData;if(pastedData.length>numberOfInputs){str=pastedData.slice(0,numberOfInputs);}setValue(str);}}function onInput(e){if(value[index.current]===e.target.value[0]){if(index.current<numberOfInputs-1){var nextInput=document.getElementById("index-".concat(index.current+1));nextInput.focus();}}}function getInputsJSX(){var inputs=[];var _loop=function _loop(i){var input=_react["default"].createElement("input",{id:"index-".concat(i),key:"input-".concat(i),className:"otp__input ".concat(inputClass),style:inputStyle,onFocus:function onFocus(e){return onInputFocus(e,i);},onChange:handleOnChange,onPaste:onPaste,value:value[i]?value[i]:"",onKeyDown:handleKeyDown,placeholder:placeholder,onInput:onInput,disabled:isDisabled});inputs.push(input);};for(var i=0;i<numberOfInputs;i++){_loop(i);}return inputs;}var inputsJSX=getInputsJSX();return _react["default"].createElement("div",{className:"input-card"},_react["default"].createElement("div",{className:"form-container ".concat(containerClass),style:containerStyle},_react["default"].createElement("div",{className:"otp"},_react["default"].createElement("div",{className:"otp__title ".concat(primaryTextClass),style:primaryTextStyle},primaryText),_react["default"].createElement("div",{className:"otp__line"}),_react["default"].createElement("div",{className:"otp__content ".concat(secondaryTextClass),style:secondaryTextStyle},secondaryText),_react["default"].createElement("div",{ref:ref},inputsJSX),_react["default"].createElement("div",{className:"otp__alternate-options"},_react["default"].createElement("button",{className:"otp__alternate-options__changebtn ".concat(secondaryButtonClass),style:secondaryButtonStyle,onClick:handleOnClear,disabled:isDisabled||isDisabledClear},"Clear input"),!isResendInactive?_react["default"].createElement("button",{className:"otp__alternate-options__changebtn ".concat(secondaryButtonClass),style:secondaryButtonStyle,onClick:handleOnResend},"Resend OTP"):_react["default"].createElement("span",{className:"otp__alternate-options__timer"},"Resend OTP in ",minutes<10?"0"+minutes:minutes,":",counter<10?"0"+counter:counter)),_react["default"].createElement("button",{className:"otp__submit-btn ".concat(primaryButtonClass),style:primaryButtonStyle,disabled:isDisabledSubmit,onClick:onOTPSubmit},"Verify Phone Number"))));}OTP.defaultProps={value:"",numberOfInputs:4,isNumber:false,placeholder:"0",inputStyle:{},inputClass:"",containerStyle:{},containerClass:"",primaryTextStyle:{},primaryTextClass:"",secondaryTextStyle:{},secondaryTextClass:"",primaryButtonStyle:{},primaryButtonClass:"",secondaryButtonStyle:{},secondaryButtonClass:"",hasErrored:false,isDisabled:false,resendDuration:60,onOtpResend:function onOtpResend(){},primaryText:"Phone Verification",secondaryText:"Enter the OTP you received on 89206-6XXXX",onOTPSubmit:function onOTPSubmit(){}};OTP.propTypes={value:_propTypes["default"].string.isRequired,setValue:_propTypes["default"].func.isRequired,numberOfInputs:_propTypes["default"].number,isNumber:_propTypes["default"].bool,placeholder:_propTypes["default"].string,inputStyle:_propTypes["default"].object,inputClass:_propTypes["default"].string,containerStyle:_propTypes["default"].object,containerClass:_propTypes["default"].string,hasErrored:_propTypes["default"].bool,isDisabled:_propTypes["default"].bool,resendDuration:_propTypes["default"].number,onOtpResend:_propTypes["default"].func,primaryText:_propTypes["default"].string,secondaryText:_propTypes["default"].string,primaryTextStyle:_propTypes["default"].object,primaryTextClass:_propTypes["default"].string,secondaryTextStyle:_propTypes["default"].object,secondaryTextClass:_propTypes["default"].string,primaryButtonStyle:_propTypes["default"].object,primaryButtonClass:_propTypes["default"].string,secondaryButtonStyle:_propTypes["default"].object,secondaryButtonClass:_propTypes["default"].string,onOTPSubmit:_propTypes["default"].func};var _default=OTP;exports["default"]=_default;